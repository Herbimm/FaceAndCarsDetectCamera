@page "/counter"
@using Emgu.CV;
@using System;
@using Emgu.CV.Structure
@using Emgu.CV.UI
@using SkiaSharp

<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;

    private async void IncrementCount()
    {
        currentCount++;
        
        
        var faceCascade = new CascadeClassifier(@"C:\Users\hscar\source\repos\ConsoleApp1\ConsoleApp1\detection\haarcascade_frontalface_default.xml");
        var vc = new VideoCapture(0, Emgu.CV.VideoCapture.API.DShow);

        Mat frame = new();
        Mat frameGray = new();

        while (true)
        {
            vc.Read(frame);

            CvInvoke.CvtColor(frame, frameGray, Emgu.CV.CvEnum.ColorConversion.Bgr2Gray);

            var faces = faceCascade.DetectMultiScale(frameGray, 1.3, 5);

            if (faces is not null && faces.Length > 0)
            {
                CvInvoke.Rectangle(frame, faces[0], new Emgu.CV.Structure.MCvScalar(0, 255, 0), 2);

                CvInvoke.Imshow("face detection", frame);

                if (CvInvoke.WaitKey(1) == 27)
                {
                    break;
                }
            }
        }

    }
}
